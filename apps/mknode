#!/bin/bash
PATH=$(dirname "$(readlink -f "${0}")")/..:$PATH
DIR=/tmp/dwarf-portable-executable
mkdir -p $DIR
BASE=https://nodejs.org/dist/latest
LINK="$BASE/$(curl -L $BASE | grep linux-x64.tar.xz | cut -d'"' -f2)"
curl -L "$LINK" | bsdtar xf - -C$DIR

mv $DIR/node* $DIR/node
strip $DIR/node/bin/node
cat > $DIR/node/AppRun << 'EOF'
#!/bin/sh
HERE=$(dirname $(readlink -f "${0}"))
export PATH="${HERE}/bin":$PATH
"${HERE}"/bin/$APPDWARF_CMD $@
EOF
chmod +x $DIR/node/AppRun

appdwarf $DIR/node
mv $DIR/node.sh node
rm -rf $DIR/node
